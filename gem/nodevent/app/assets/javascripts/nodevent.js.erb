//= require head
function NoDevent(opts, fn) {            
  var s = io.connect("<%= NoDevent::Config.connect_url  %>");
      
  var m = new EventEmitter();
  m.s = s;
  
  m.room = new EventEmitter();
  
  m.join = function(room) {
    s.emit('join', {user : opts.user, room : room});
  };
  
  m.leave = function(room) {
    s.emit('leave', {user : opts.user, room : room});
  }; 
  
  s.on(
    'event', 
    function (data) {
      console.log(data);
      var event = data.event;
      var message = data.message;
      
      m.emit(event, message);
    });
    
  s.on(
    'join_room', 
    function (data) {      
      console.log(data.room, data.user);
      m.room.emit('join', data);
    });
  return m;
}

NoDevent.ready = function(fn) {
  head.js(     
    "<%= NoDevent::Config.socket_io_js  %>", "/assets/EventEmitter.js",
    fn);
};
      